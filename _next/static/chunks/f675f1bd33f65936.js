(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,921399,t=>{"use strict";function i(t){switch(t.split(".").pop()?.toLowerCase()){case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"webp":return"image/webp";case"avif":return"image/avif";default:return"application/octet-stream"}}t.s(["determineMime",()=>i])},678192,t=>{t.v("/_next/static/media/avif.worker.edd7e6a7.ts")},510169,t=>{t.v(t.b(["static/chunks/09ba271d4187726d.js","static/chunks/turbopack-e487681470dcc225.js"]))},385876,t=>{"use strict";class i{info;option;constructor(t,i){this.info=t,this.option=i}getOutputDimension(){let{method:t,width:i,height:e,short:h,long:s,cropWidthRatio:n,cropHeightRatio:o,cropWidthSize:r,cropHeightSize:a}=this.option.resize,f={x:0,y:0,width:this.info.width,height:this.info.height};if("fitWidth"===t){if(!i)return f;let t=i/this.info.width*this.info.height;return{x:0,y:0,width:Math.ceil(i),height:Math.ceil(t)}}if("fitHeight"===t)return e?{x:0,y:0,width:Math.ceil(e/this.info.height*this.info.width),height:Math.ceil(e)}:f;if("setShort"===t){let t,i;return h?(this.info.width<=this.info.height?i=(t=h)/this.info.width*this.info.height:t=(i=h)/this.info.height*this.info.width,{x:0,y:0,width:Math.ceil(t),height:Math.ceil(i)}):f}if("setLong"===t){let t,i;return s?(this.info.width>=this.info.height?i=(t=s)/this.info.width*this.info.height:t=(i=s)/this.info.height*this.info.width,{x:0,y:0,width:Math.ceil(t),height:Math.ceil(i)}):f}if("setCropRatio"===t){if(!n||!o)return f;let t=0,i=0,e=0,h=0;return n/o>=this.info.width/this.info.height?(t=0,e=this.info.width,h=this.info.width*o/n,i=(this.info.height-h)/2):(i=0,h=this.info.height,e=this.info.height*n/o,t=(this.info.width-e)/2),{x:Math.ceil(t),y:Math.ceil(i),width:Math.ceil(e),height:Math.ceil(h)}}if("setCropSize"===t){if(!r||!a)return f;let t=r,i=a;return r>=this.info.width&&(t=this.info.width),a>=this.info.height&&(i=this.info.height),{x:Math.ceil((this.info.width-t)/2),y:Math.ceil((this.info.height-i)/2),width:Math.ceil(t),height:Math.ceil(i)}}return f}failResult(){return{width:this.info.width,height:this.info.height,blob:this.info.blob,src:URL.createObjectURL(this.info.blob)}}getPreviewDimension(){let t,i,e=this.option.preview.maxSize;if(Math.max(this.info.width,this.info.height)<=e)return{x:0,y:0,width:this.info.width,height:this.info.height};if(this.info.width>=this.info.height){let h=e/this.info.width;t=e,i=h*this.info.height}else t=e/this.info.height*this.info.width,i=e;return{x:0,y:0,width:Math.ceil(t),height:Math.ceil(i)}}async preview(){let{width:t,height:i,x:e,y:h}=this.getPreviewDimension(),s=await this.createBlob(t,i,e,h);return{width:t,height:i,blob:s,src:URL.createObjectURL(s)}}async createCanvas(t,i,e=0,h=0){let s=new OffscreenCanvas(t,i),n=s.getContext("2d"),o=await createImageBitmap(this.info.blob),r=this.option.resize.method;return r&&["setCropRatio","setCropSize"].includes(r)?n?.drawImage(o,e,h,t,i,0,0,t,i):n?.drawImage(o,0,0,this.info.width,this.info.height,0,0,t,i),o.close(),{canvas:s,context:n}}async createBlob(t,i,e=.6,h=0,s=0){let{canvas:n}=await this.createCanvas(t,i,h,s),o={type:this.info.blob.type,quality:e};return n.convertToBlob(o)}}let e=null,h=0,s=new Map,n=new Map;class o extends i{async compress(){try{let{width:i,height:o,x:r,y:a}=this.getOutputDimension(),{canvas:f,context:l}=await this.createCanvas(i,o,r,a),c=l.getImageData(0,0,i,o),d=new Uint8Array(c.data.buffer),g=this.option.avif?.quality??50,w=this.option.avif?.speed??8,u=await ((i,o,r,a=50,f=6)=>new Promise((l,c)=>{let d=h++;s.set(d,l),n.set(d,c),(!e&&((e=new Worker(t.r(510169),{type:"module",type:void 0})).onmessage=t=>{let{id:i,result:e,error:h,type:o}=t.data;"ready"!==o&&(h?n.get(i)?.(Error(h)):s.get(i)?.(e),s.delete(i),n.delete(i))},e.onerror=t=>{console.error("AVIF Worker error:",t),e?.terminate(),e=null}),e).postMessage({id:d,bytes:i,width:o,height:r,quality:a,speed:f},[i.buffer])}))(d,i,o,g,w),p=new Blob([u],{type:"image/avif"});return{width:i,height:o,blob:p,src:URL.createObjectURL(p)}}catch(t){return console.warn("AVIF failed:",t),this.failResult()}}}var r=t.i(921399);self.onmessage=async t=>{let{id:i,file:e,name:h,width:s,height:n,option:a}=t.data;try{let t;e instanceof Blob?t=e:ArrayBuffer.isView(e)?t=new Blob([e.buffer],{type:(0,r.determineMime)(h)}):t=new Blob([e],{type:(0,r.determineMime)(h)});let f={key:1,name:h,width:s,height:n,blob:t},l=new o(f,{...a,avif:{quality:a.avif?.quality??50,speed:8}}),c=await l.compress(),d=await c.blob.arrayBuffer();self.postMessage({id:i,data:d,width:c.width,height:c.height},[d])}catch(t){console.error("AVIF worker compression error:",t),self.postMessage({id:i,error:String(t??"Compression failed")})}},t.s([],385876)}]);