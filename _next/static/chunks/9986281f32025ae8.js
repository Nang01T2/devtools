(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,102579,e=>{e.v("/_next/static/media/imageWorker.3dd186a3.ts")},701870,486415,e=>{"use strict";let t=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),a=()=>(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));async function r(e,t,a){return e({...a,locateFile:e=>e.endsWith(".wasm")?new URL(e,location.origin).toString():e,...t?{wasmModule:t}:{}})}function n(e,t){return console.time(e),t().finally(()=>console.timeEnd(e))}function l(e){if(e.aborted)throw new DOMException("AbortError","AbortError")}async function s(e,t){return l(e),Promise.race([t,new Promise((t,a)=>{e.addEventListener("abort",()=>a(new DOMException("AbortError","AbortError")))})])}e.s(["simd",0,t,"threads",0,a],486415),e.s(["abortable",()=>s,"initEmscriptenModule",()=>r,"timed",()=>n],701870)},255519,e=>{"use strict";let t=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),n=Symbol("Comlink.finalizer"),l=Symbol("Comlink.thrown"),s=e=>"object"==typeof e&&null!==e||"function"==typeof e,i=new Map([["proxy",{canHandle:e=>s(e)&&e[t],serialize(e){let{port1:t,port2:a}=new MessageChannel;return c(e,t),[a,[a]]},deserialize:e=>(e.start(),h(e))}],["throw",{canHandle:e=>s(e)&&l in e,serialize({value:e}){let t;return[t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function o(e,t){for(let a of e)if(t===a||"*"===a||a instanceof RegExp&&a.test(t))return!0;return!1}function c(e,t=globalThis,a=["*"]){t.addEventListener("message",function r(s){let i;if(!s||!s.data)return;if(!o(a,s.origin))return void console.warn(`Invalid origin '${s.origin}' for comlink proxy`);let{id:d,type:h,path:m}=Object.assign({path:[]},s.data),g=(s.data.argumentList||[]).map(C);try{let t=m.slice(0,-1).reduce((e,t)=>e[t],e),a=m.reduce((e,t)=>e[t],e);switch(h){case"GET":i=a;break;case"SET":t[m.slice(-1)[0]]=C(s.data.value),i=!0;break;case"APPLY":i=a.apply(t,g);break;case"CONSTRUCT":{let e=new a(...g);i=k(e)}break;case"ENDPOINT":{let{port1:t,port2:a}=new MessageChannel;c(e,a),i=N(t,[t])}break;case"RELEASE":i=void 0;break;default:return}}catch(e){i={value:e,[l]:0}}Promise.resolve(i).catch(e=>({value:e,[l]:0})).then(a=>{let[l,s]=E(a);t.postMessage(Object.assign(Object.assign({},l),{id:d}),s),"RELEASE"===h&&(t.removeEventListener("message",r),u(t),n in e&&"function"==typeof e[n]&&e[n]())}).catch(e=>{let[a,r]=E({value:TypeError("Unserializable return value"),[l]:0});t.postMessage(Object.assign(Object.assign({},a),{id:d}),r)})}),t.start&&t.start()}function d(e){return"MessagePort"===e.constructor.name}function u(e){d(e)&&e.close()}function h(e,t){let a=new Map;return e.addEventListener("message",function(e){let{data:t}=e;if(!t||!t.id)return;let r=a.get(t.id);if(r)try{r(t)}finally{a.delete(t.id)}}),w(e,a,[],t)}function m(e){if(e)throw Error("Proxy has been released and is not useable")}function g(e){return S(e,new Map,{type:"RELEASE"}).then(()=>{u(e)})}let b=new WeakMap,f="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(b.get(e)||0)-1;b.set(e,t),0===t&&g(e)});function p(e,t){let a=(b.get(t)||0)+1;b.set(t,a),f&&f.register(e,t,e)}function x(e){f&&f.unregister(e)}function w(e,t,n=[],l=function(){}){let s=!1,i=new Proxy(l,{get(a,l){if(m(s),l===r)return()=>{x(i),g(e),t.clear(),s=!0};if("then"===l){if(0===n.length)return{then:()=>i};let a=S(e,t,{type:"GET",path:n.map(e=>e.toString())}).then(C);return a.then.bind(a)}return w(e,t,[...n,l])},set(a,r,l){m(s);let[i,o]=E(l);return S(e,t,{type:"SET",path:[...n,r].map(e=>e.toString()),value:i},o).then(C)},apply(r,l,i){m(s);let o=n[n.length-1];if(o===a)return S(e,t,{type:"ENDPOINT"}).then(C);if("bind"===o)return w(e,t,n.slice(0,-1));let[c,d]=v(i);return S(e,t,{type:"APPLY",path:n.map(e=>e.toString()),argumentList:c},d).then(C)},construct(a,r){m(s);let[l,i]=v(r);return S(e,t,{type:"CONSTRUCT",path:n.map(e=>e.toString()),argumentList:l},i).then(C)}});return p(i,e),i}function y(e){return Array.prototype.concat.apply([],e)}function v(e){let t=e.map(E);return[t.map(e=>e[0]),y(t.map(e=>e[1]))]}let j=new WeakMap;function N(e,t){return j.set(e,t),e}function k(e){return Object.assign(e,{[t]:!0})}function E(e){for(let[t,a]of i)if(a.canHandle(e)){let[r,n]=a.serialize(e);return[{type:"HANDLER",name:t,value:r},n]}return[{type:"RAW",value:e},j.get(e)||[]]}function C(e){switch(e.type){case"HANDLER":return i.get(e.name).deserialize(e.value);case"RAW":return e.value}}function S(e,t,a,r){return new Promise(n=>{let l=R();t.set(l,n),e.start&&e.start(),e.postMessage(Object.assign({id:l},a),r)})}function R(){return[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}e.s(["expose",()=>c,"proxy",()=>k,"transfer",()=>N,"wrap",()=>h])},469214,e=>{e.v(e.b(["static/chunks/adbb901e8ebb410a.js","static/chunks/c7c926fe4f7e0207.js","static/chunks/turbopack-57d252eaf2532062.js"]))},570766,e=>{"use strict";var t=e.i(255519);let a=["avifEncode","webpEncode","jxlEncode","avifDecode","webpDecode","mozjpegEncode","jxlDecode","qoiEncode","resize","quantize","rotate","flipHorizontal","flipVertical","grayscale","sepia","sharpen","gaussianBlur","brightness","contrast","hueRotate","watermark","filter","blendOver","blendOverlay","blendAtop","blendPlus","blendMultiply","blendBurn","blendDifference","blendSoftLight","blendHardLight","blendDodge","blendExclusion","blendLighten","blendDarken","pixelateBlur"];var r=e.i(701870);let n=1e4;class l{_queue=Promise.resolve();_worker;_workerApi;_workerTimeout;_terminateWorker(){this._worker&&(this._worker.terminate(),this._worker=void 0,this._workerApi=void 0)}_startWorker(){this._worker=new Worker(e.r(469214),{type:"module",type:void 0}),this._workerApi=t.wrap(this._worker)}}for(let e of a)l.prototype[e]=function(t,...a){return this._queue=this._queue.catch(()=>{}).then(async()=>{if(t.aborted)throw new DOMException("AbortError","AbortError");clearTimeout(this._workerTimeout),this._worker||this._startWorker();let l=()=>this._terminateWorker();return t.addEventListener("abort",l),(0,r.abortable)(t,this._workerApi[e](...a)).finally(()=>{t.removeEventListener("abort",l),this._workerTimeout=setTimeout(()=>{this._terminateWorker()},n)})}),this._queue};let s=new l;e.s(["processor",0,s],570766)},754717,__turbopack_context__=>{"use strict";var __TURBOPACK__imported__module__843476__=__turbopack_context__.i(843476),__TURBOPACK__imported__module__271645__=__turbopack_context__.i(271645),__TURBOPACK__imported__module__570766__=__turbopack_context__.i(570766),__TURBOPACK__imported__module__843476__1=__TURBOPACK__imported__module__843476__;function ImageControls({rotation:e,setRotation:t,blurRadius:a,setBlurRadius:r,brightness:n,setBrightness:l,contrast:s,setContrast:i,hue:o,setHue:c,activeFilter:d,setActiveFilter:u,activeBlendMode:h,setActiveBlendMode:m,effects:g,setEffects:b,watermark:f,setWatermark:p,overlayData:x,isProcessing:w,faceBlurEnabled:y,setFaceBlurEnabled:v,facePixelateEnabled:j,setFacePixelateEnabled:N,faceBlurRadius:k,setFaceBlurRadius:E,faceDetectEnabled:C,setFaceDetectEnabled:S,backgroundBlurEnabled:R,setBackgroundBlurEnabled:M,backgroundBlurRadius:A,setBackgroundBlurRadius:_,originalImageRef:B}){return(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"card shadow border-0",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("div",{className:"card-header bg-primary text-white",children:(0,__TURBOPACK__imported__module__843476__1.jsx)("h5",{className:"mb-0",children:"ImageProcessor Controls"})}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"card-body overflow-auto",style:{maxHeight:"85vh"},children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Rotation: ",e,"°"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"-180",max:"180",step:"1",value:e,onChange:e=>t(Number(e.target.value))}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"btn-group w-100 mt-2",role:"group",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>t(0),children:"Reset"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>t(90),children:"90°"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>t(180),children:"180°"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>t(-90),children:"-90°"})]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Brightness: ",n]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"-100",max:"100",value:n,onChange:e=>l(Number(e.target.value))})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Contrast: ",s]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"-100",max:"100",value:s,onChange:e=>i(Number(e.target.value))})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Hue Rotation: ",o,"°"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"0",max:"360",value:o,onChange:e=>c(Number(e.target.value))})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-label fw-bold d-block mb-3",children:"Preset Filters"}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"d-grid gap-2",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn btn-sm ${null===d?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>u(null),children:"None (Original)"}),["oceanic","islands","marine","seagreen","flagblue","liquid","diamante","vintage","perfume","serenity","lofi","cali","obsidian","firenze","dramatic","golden","pastel_pink","radio","twenties","rosetint","mauve","bluechrome"].map(e=>(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn btn-sm ${d===e?"btn-info text-white":"btn-outline-info"}`,onClick:()=>u(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("h5",{className:"form-label fw-bold d-block mb-3",children:"Blend"}),x?(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"d-grid gap-2",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn btn-sm ${null===h?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>m(null),children:"None"}),["over","overlay","atop","plus","multiply","burn","difference","soft_light","hard_light","dodge","exclusion","lighten","darken"].map(e=>(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn btn-sm ${h===e?"btn-primary text-white":"btn-outline-primary"}`,onClick:()=>m(e),children:e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e))]}):(0,__TURBOPACK__imported__module__843476__1.jsx)("p",{className:"text-muted small",children:"Upload an overlay image to enable blend modes"})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-label fw-bold",children:"Flip & Basic Filters"}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"d-grid gap-2",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn ${g.flipHorizontal?"btn-primary":"btn-outline-primary"}`,onClick:()=>b(e=>({...e,flipHorizontal:!e.flipHorizontal})),children:"↔ Flip Horizontal"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn ${g.flipVertical?"btn-primary":"btn-outline-primary"}`,onClick:()=>b(e=>({...e,flipVertical:!e.flipVertical})),children:"↕ Flip Vertical"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn ${g.grayscale?"btn-dark":"btn-outline-dark"}`,onClick:()=>b(e=>({...e,grayscale:!e.grayscale})),children:"Grayscale"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn ${g.sepia?"btn-warning text-white":"btn-outline-warning"}`,onClick:()=>b(e=>({...e,sepia:!e.sepia})),children:"Sepia"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("button",{className:`btn ${g.sharpen?"btn-info":"btn-outline-info"}`,onClick:()=>b(e=>({...e,sharpen:!e.sharpen})),children:"Sharpen"})]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-info bg-opacity-10",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",id:"faceDetectSwitch",checked:C,onChange:e=>S(e.target.checked)}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"faceDetectSwitch",children:"Face Detector (Show Bounding Boxes)"})]}),C&&(0,__TURBOPACK__imported__module__843476__1.jsx)("small",{className:"text-muted d-block",children:"Red rectangles will be drawn around detected faces for preview."})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-light",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",id:"faceBlurSwitch",checked:y,onChange:e=>v(e.target.checked)}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"faceBlurSwitch",children:"Blur Faces Automatically (Gaussian)"})]}),y&&(0,__TURBOPACK__imported__module__843476__1.jsxs)(__TURBOPACK__imported__module__843476__1.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Face Blur Strength: ",k,"px"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range mb-2",min:"10",max:"60",step:"5",value:k,onChange:e=>E(Number(e.target.value))}),(0,__TURBOPACK__imported__module__843476__1.jsx)("small",{className:"text-muted d-block",children:"Faces are detected and blurred using AI — 100% client-side."})]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-dark bg-opacity-10",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",id:"facePixelateSwitch",checked:j,onChange:e=>N(e.target.checked)}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"facePixelateSwitch",children:"Pixelate Faces (Mosaic Style)"})]}),j&&(0,__TURBOPACK__imported__module__843476__1.jsxs)(__TURBOPACK__imported__module__843476__1.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Pixel Strength: ",k,"px"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range mb-2",min:"10",max:"60",step:"5",value:k,onChange:e=>E(Number(e.target.value))}),(0,__TURBOPACK__imported__module__843476__1.jsx)("small",{className:"text-muted d-block",children:"Applies mosaic pixelation to detected faces."})]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-success bg-opacity-10",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",id:"backgroundBlurSwitch",checked:R,onChange:e=>M(e.target.checked)}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"backgroundBlurSwitch",children:"Blur Background (Portrait Mode)"})]}),R&&(0,__TURBOPACK__imported__module__843476__1.jsxs)(__TURBOPACK__imported__module__843476__1.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Background Blur Strength: ",A,"px"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range mb-2",min:"10",max:"60",step:"5",value:A,onChange:e=>_(Number(e.target.value))}),(0,__TURBOPACK__imported__module__843476__1.jsx)("small",{className:"text-muted d-block",children:"AI detects person and blurs the background for bokeh effect."})]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-light bg-opacity-50",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",id:"styleTransferSwitch",checked:void 0!==window.__styleTransferEnabled&&window.__styleTransferEnabled,onChange:()=>{window.dispatchEvent(new CustomEvent("photoeditor:toggleStyleTransfer"))}}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"styleTransferSwitch",children:"Artistic Style Transfer (Neural)"})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-2",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-label fw-bold",children:"Style Strength"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"0",max:"1",step:"0.01",defaultValue:1,onChange:e=>window.dispatchEvent(new CustomEvent("photoeditor:styleStrength",{detail:Number(e.target.value)}))})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-2",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-label fw-bold",children:"Upload Style Image"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"file",accept:"image/*",className:"form-control",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let a=new FileReader;a.onload=e=>{window.dispatchEvent(new CustomEvent("photoeditor:styleImage",{detail:e.target?.result}))},a.readAsDataURL(t)}}),(0,__TURBOPACK__imported__module__843476__1.jsx)("small",{className:"text-muted d-block mt-1",children:"Upload any artwork or photo to use as the style source."})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("small",{className:"text-muted d-block mt-2",children:["Note: This loads a TensorFlow.js model at runtime. Run"," ",(0,__TURBOPACK__imported__module__843476__1.jsx)("code",{children:"npm install @tensorflow/tfjs @tensorflow-models/arbitrary-image-stylization"})," ","to enable."]})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("label",{className:"form-label fw-bold",children:["Global Blur Radius: ",a,"px"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range",min:"0",max:"30",value:a,onChange:e=>r(Number(e.target.value))})]}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-4 p-3 border rounded bg-light",children:[(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"form-check mb-3",children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{className:"form-check-input",type:"checkbox",checked:f.enabled,onChange:e=>p(t=>({...t,enabled:e.target.checked}))}),(0,__TURBOPACK__imported__module__843476__1.jsx)("label",{className:"form-check-label fw-bold",children:"Add Watermark"})]}),f.enabled&&(0,__TURBOPACK__imported__module__843476__1.jsxs)(__TURBOPACK__imported__module__843476__1.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"text",className:"form-control mb-2",placeholder:"Watermark text",value:f.text,onChange:e=>p(t=>({...t,text:e.target.value}))}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"range",className:"form-range mb-2",min:"12",max:"120",value:f.size,onChange:e=>p(t=>({...t,size:Number(e.target.value)}))}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("div",{className:"mb-2",children:["Size: ",f.size,"px"]}),(0,__TURBOPACK__imported__module__843476__1.jsx)("input",{type:"color",className:"form-control form-control-color mb-2",value:f.color,onChange:e=>p(t=>({...t,color:e.target.value}))}),(0,__TURBOPACK__imported__module__843476__1.jsxs)("select",{className:"form-select",value:f.position,onChange:e=>p(t=>({...t,position:e.target.value})),children:[(0,__TURBOPACK__imported__module__843476__1.jsx)("option",{value:"top-left",children:"Top Left"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("option",{value:"top-right",children:"Top Right"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("option",{value:"bottom-left",children:"Bottom Left"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("option",{value:"bottom-right",children:"Bottom Right"}),(0,__TURBOPACK__imported__module__843476__1.jsx)("option",{value:"center",children:"Center"})]})]})]}),w&&(0,__TURBOPACK__imported__module__843476__1.jsx)("div",{className:"text-center my-4",children:(0,__TURBOPACK__imported__module__843476__1.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,__TURBOPACK__imported__module__843476__1.jsx)("span",{className:"visually-hidden",children:"Processing..."})})})]})]})}let __TURBOPACK__default__export__=ImageControls;var __TURBOPACK__imported__module__843476__2=__TURBOPACK__imported__module__843476__,__TURBOPACK__imported__module__271645__1=__TURBOPACK__imported__module__271645__;function PhotoCanvas({processedData:e,canvasRef:t,overlayCanvasRef:a,maskCanvasRef:r,latestDetections:n,faceDetectEnabled:l}){return(0,__TURBOPACK__imported__module__271645__1.useEffect)(()=>{if(!e||!t.current)return;let s=t.current;s.width=e.width,s.height=e.height;let i=s.getContext("2d");if(i){if(i.putImageData(e,0,0),l&&n&&n.length>0)for(let e of(i.strokeStyle="#FF0000",i.lineWidth=4,i.fillStyle="#FF0000",i.font="20px Arial",n)){let t=e.boundingBox;i.strokeRect(t.originX,t.originY,t.width,t.height);let a=e.categories?.[0]?.score;void 0!==a&&i.fillText(`Face ${(100*a).toFixed(1)}%`,t.originX,t.originY-10)}if(a.current){let t=a.current;t.width=e.width,t.height=e.height,t.getContext("2d")}if(r.current){let t=r.current;t.width=e.width,t.height=e.height}}},[e,t,a,r]),(0,__TURBOPACK__imported__module__843476__2.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,__TURBOPACK__imported__module__843476__2.jsx)("canvas",{ref:t,className:"img-fluid rounded shadow",style:{maxHeight:"75vh",border:"1px solid #ddd",display:"block"}}),(0,__TURBOPACK__imported__module__843476__2.jsx)("canvas",{ref:a,style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",borderRadius:8,mixBlendMode:"normal",display:"block"}}),(0,__TURBOPACK__imported__module__843476__2.jsx)("canvas",{ref:r,style:{display:"none"}})]})}var __TURBOPACK__imported__module__843476__3=__TURBOPACK__imported__module__843476__,__TURBOPACK__imported__module__271645__2=__TURBOPACK__imported__module__271645__,__TURBOPACK__imported__module__570766__1=__TURBOPACK__imported__module__570766__;function ObjectRemovalPanel({maskCanvasRef:e,overlayCanvasRef:t,originalData:a,setOriginalData:r,isProcessing:n,setIsProcessing:l}){let[s,i]=(0,__TURBOPACK__imported__module__271645__2.useState)(!1),[o,c]=(0,__TURBOPACK__imported__module__271645__2.useState)(!1),[d,u]=(0,__TURBOPACK__imported__module__271645__2.useState)(32),h=(0,__TURBOPACK__imported__module__271645__2.useRef)(!1),m=e=>{let a=t.current;if(!a)return null;let r=a.getBoundingClientRect();return{x:Math.round((e.clientX-r.left)*(a.width/r.width)),y:Math.round((e.clientY-r.top)*(a.height/r.height))}},g=(a,r)=>{let n=e.current,l=t.current;if(!n||!l)return;let s=n.getContext("2d"),i=l.getContext("2d");s&&i&&(s.fillStyle="rgba(255,255,255,1)",s.beginPath(),s.arc(a,r,d,0,2*Math.PI),s.fill(),i.fillStyle="rgba(255,0,0,0.4)",i.beginPath(),i.arc(a,r,d,0,2*Math.PI),i.fill())};(0,__TURBOPACK__imported__module__271645__2.useEffect)(()=>{let e=t.current;if(!e)return;let a=t=>{if(!o)return;h.current=!0;try{e.setPointerCapture(t.pointerId)}catch{}let a=m(t);a&&g(a.x,a.y)},r=e=>{if(!h.current)return;let t=m(e);t&&g(t.x,t.y)},n=t=>{h.current=!1;try{e.releasePointerCapture(t.pointerId)}catch{}};return e.addEventListener("pointerdown",a),e.addEventListener("pointermove",r),window.addEventListener("pointerup",n),()=>{e.removeEventListener("pointerdown",a),e.removeEventListener("pointermove",r),window.removeEventListener("pointerup",n)}},[o,d,t,e]),(0,__TURBOPACK__imported__module__271645__2.useEffect)(()=>{let e=t.current;e&&(e.style.pointerEvents=o?"auto":"none",e.style.cursor=o?"crosshair":"default"),s||b()},[s,o,t]);let b=()=>{let a=e.current,r=t.current;if(a){let e=a.getContext("2d");e&&e.clearRect(0,0,a.width,a.height)}if(r){let e=r.getContext("2d");e&&e.clearRect(0,0,r.width,r.height)}},f=(e,t)=>{let a=e.width,r=e.height,n=e.data,l=new ImageData(new Uint8ClampedArray(n),a,r),s=t.getContext("2d");if(!s)return e;let i=s.getImageData(0,0,a,r).data,o=(e,t)=>i[(t*a+e)*4]>127,c=60;for(let e=0;e<r;e++)for(let t=0;t<a;t++){if(!o(t,e))continue;let s=!1;for(let i=1;i<=c&&!s;i++)for(let c=-i;c<=i&&!s;c++){let d=e+c;if(d<0||d>=r)continue;let u=i-Math.abs(c);for(let r of[t-u,t+u])if(!(r<0)&&!(r>=a)&&!o(r,d)){let i=(d*a+r)*4,o=(e*a+t)*4;l.data[o]=n[i],l.data[o+1]=n[i+1],l.data[o+2]=n[i+2],l.data[o+3]=n[i+3],s=!0;break}}}return l},p=async()=>{if(e.current&&a){l(!0);try{let t=f(a,e.current),n=await __TURBOPACK__imported__module__570766__1.processor.gaussianBlur(new AbortController().signal,t,4);r(n),b()}catch(e){console.error("Object removal failed:",e)}finally{l(!1)}}};return(0,__TURBOPACK__imported__module__843476__3.jsxs)("div",{className:"card shadow border-0 mt-3",children:[(0,__TURBOPACK__imported__module__843476__3.jsx)("div",{className:"card-header bg-warning text-dark",children:(0,__TURBOPACK__imported__module__843476__3.jsx)("h5",{className:"mb-0",children:"Object Removal"})}),(0,__TURBOPACK__imported__module__843476__3.jsxs)("div",{className:"card-body",children:[(0,__TURBOPACK__imported__module__843476__3.jsxs)("div",{className:"form-check form-switch mb-3",children:[(0,__TURBOPACK__imported__module__843476__3.jsx)("input",{className:"form-check-input",type:"checkbox",id:"objectRemovalSwitch",checked:s,onChange:e=>i(e.target.checked)}),(0,__TURBOPACK__imported__module__843476__3.jsx)("label",{className:"form-check-label fw-bold",htmlFor:"objectRemovalSwitch",children:"Enable Object Removal Tool"})]}),s&&(0,__TURBOPACK__imported__module__843476__3.jsxs)(__TURBOPACK__imported__module__843476__3.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__3.jsxs)("div",{className:"mb-2",children:[(0,__TURBOPACK__imported__module__843476__3.jsxs)("label",{className:"form-label fw-bold",children:["Brush Size: ",d,"px"]}),(0,__TURBOPACK__imported__module__843476__3.jsx)("input",{type:"range",className:"form-range",min:"4",max:"120",value:d,onChange:e=>u(Number(e.target.value))})]}),(0,__TURBOPACK__imported__module__843476__3.jsxs)("div",{className:"btn-group w-100",role:"group",children:[(0,__TURBOPACK__imported__module__843476__3.jsx)("button",{className:`btn btn-sm ${o?"btn-primary":"btn-outline-primary"}`,onClick:()=>c(e=>!e),children:o?"Stop Painting":"Paint Mask"}),(0,__TURBOPACK__imported__module__843476__3.jsx)("button",{className:"btn btn-sm btn-success",onClick:p,disabled:n,children:"Apply Removal"}),(0,__TURBOPACK__imported__module__843476__3.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:b,children:"Clear Mask"})]}),(0,__TURBOPACK__imported__module__843476__3.jsx)("small",{className:"text-muted d-block mt-2",children:"Toggle painting, draw over the area to remove, then click Apply."})]})]})]})}var __TURBOPACK__imported__module__57166__=__turbopack_context__.i(57166);function PhotoEditor(){let canvasRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),fileInputRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),overlayInputRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),originalImageRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),[originalImage,setOriginalImage]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[originalData,setOriginalData]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[overlayData,setOverlayData]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[processedData,setProcessedData]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[isProcessing,setIsProcessing]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[imageUrl,setImageUrl]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[rotation,setRotation]=(0,__TURBOPACK__imported__module__271645__.useState)(0),[blurRadius,setBlurRadius]=(0,__TURBOPACK__imported__module__271645__.useState)(0),[brightness,setBrightness]=(0,__TURBOPACK__imported__module__271645__.useState)(0),[contrast,setContrast]=(0,__TURBOPACK__imported__module__271645__.useState)(0),[hue,setHue]=(0,__TURBOPACK__imported__module__271645__.useState)(0),[activeFilter,setActiveFilter]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[activeBlendMode,setActiveBlendMode]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[effects,setEffects]=(0,__TURBOPACK__imported__module__271645__.useState)({grayscale:!1,sepia:!1,sharpen:!1,flipHorizontal:!1,flipVertical:!1}),[watermark,setWatermark]=(0,__TURBOPACK__imported__module__271645__.useState)({enabled:!1,text:"Test Water Mark 2025",size:120,color:"#ffffff",opacity:.6,position:"bottom-right"}),[faceBlurEnabled,setFaceBlurEnabled]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[facePixelateEnabled,setFacePixelateEnabled]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[faceBlurRadius,setFaceBlurRadius]=(0,__TURBOPACK__imported__module__271645__.useState)(30),[faceDetectEnabled,setFaceDetectEnabled]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[backgroundBlurEnabled,setBackgroundBlurEnabled]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[backgroundBlurRadius,setBackgroundBlurRadius]=(0,__TURBOPACK__imported__module__271645__.useState)(30),[styleTransferEnabled,setStyleTransferEnabled]=(0,__TURBOPACK__imported__module__271645__.useState)(!1),[styleImageUrl,setStyleImageUrl]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[styleImageElement,setStyleImageElement]=(0,__TURBOPACK__imported__module__271645__.useState)(null),[styleStrength,setStyleStrength]=(0,__TURBOPACK__imported__module__271645__.useState)(1),latestDetections=(0,__TURBOPACK__imported__module__271645__.useRef)([]),maskCanvasRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),overlayCanvasRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),visionFilesetRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),faceDetectorRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),imageSegmenterRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),tfRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),styleModelRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),applyTimeoutRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),processingControllerRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),contentCanvasRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),outCanvasRef=(0,__TURBOPACK__imported__module__271645__.useRef)(null),handleUpload=e=>{let t=e.target.files?.[0];if(!t)return;let a=new FileReader;a.onload=e=>{let t=e.target?.result;setImageUrl(t);let a=new Image;a.onload=()=>{setOriginalImage(a),originalImageRef.current=a;let e=document.createElement("canvas");e.width=a.width,e.height=a.height;let t=e.getContext("2d");t&&(t.drawImage(a,0,0),setOriginalData(t.getImageData(0,0,a.width,a.height))),setRotation(0),setBlurRadius(0),setBrightness(0),setContrast(0),setHue(0),setActiveFilter(null),setActiveBlendMode(null),setEffects({grayscale:!1,sepia:!1,sharpen:!1,flipHorizontal:!1,flipVertical:!1}),setWatermark(e=>({...e,enabled:!1})),setOverlayData(null),setFaceBlurEnabled(!1),setFacePixelateEnabled(!1),setFaceDetectEnabled(!1),setBackgroundBlurEnabled(!1)},a.src=t,a.crossOrigin="anonymous"},a.readAsDataURL(t)},handleOverlayUpload=e=>{let t=e.target.files?.[0];if(!t||!originalData)return;let a=new FileReader;a.onload=e=>{let t=e.target?.result,a=new Image;a.onload=()=>{let e=document.createElement("canvas");e.width=a.width,e.height=a.height;let t=e.getContext("2d");t&&(t.drawImage(a,0,0),setOverlayData(t.getImageData(0,0,a.width,a.height)),activeBlendMode||setActiveBlendMode("over"))},a.src=t},a.readAsDataURL(t)};(0,__TURBOPACK__imported__module__271645__.useEffect)(()=>{if(!originalData||!originalImageRef.current)return;let applyAll=async()=>{if(setIsProcessing(!0),processingControllerRef.current)try{processingControllerRef.current.abort()}catch(e){}let controller=new AbortController;processingControllerRef.current=controller;let MAX_PREVIEW_DIM=1200,processingScale=1,detectTarget=originalImageRef.current,current=originalData;if(originalData.width>MAX_PREVIEW_DIM||originalData.height>MAX_PREVIEW_DIM){processingScale=MAX_PREVIEW_DIM/Math.max(originalData.width,originalData.height);let previewCanvas=contentCanvasRef.current;previewCanvas||(contentCanvasRef.current=previewCanvas=document.createElement("canvas")),previewCanvas.width=Math.max(1,Math.round(originalData.width*processingScale)),previewCanvas.height=Math.max(1,Math.round(originalData.height*processingScale));let pctx=previewCanvas.getContext("2d");pctx&&originalImageRef.current&&(pctx.clearRect(0,0,previewCanvas.width,previewCanvas.height),pctx.drawImage(originalImageRef.current,0,0,previewCanvas.width,previewCanvas.height),current=pctx.getImageData(0,0,previewCanvas.width,previewCanvas.height),detectTarget=previewCanvas)}let detections=[];try{if((faceBlurEnabled||facePixelateEnabled||faceDetectEnabled)&&(visionFilesetRef.current||(visionFilesetRef.current=await __TURBOPACK__imported__module__57166__.FilesetResolver.forVisionTasks()),faceDetectorRef.current||(faceDetectorRef.current=await __TURBOPACK__imported__module__57166__.FaceDetector.createFromOptions(visionFilesetRef.current,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_detector/blaze_face_short_range/float16/1/blaze_face_short_range.tflite",delegate:"GPU"},runningMode:"IMAGE"})),latestDetections.current=detections=faceDetectorRef.current.detect(detectTarget).detections),backgroundBlurEnabled){visionFilesetRef.current||(visionFilesetRef.current=await __TURBOPACK__imported__module__57166__.FilesetResolver.forVisionTasks()),imageSegmenterRef.current||(imageSegmenterRef.current=await __TURBOPACK__imported__module__57166__.ImageSegmenter.createFromOptions(visionFilesetRef.current,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_segmenter/float16/latest/selfie_segmenter.tflite",delegate:"GPU"},runningMode:"IMAGE",outputCategoryMask:!0}));let segmentationResult=imageSegmenterRef.current.segment(detectTarget);if(segmentationResult.categoryMask){let mask=segmentationResult.categoryMask,maskData=await mask.getAsUint8Array(),maskWidth=mask.width??current.width,maskHeight=mask.height??current.height,centerSum=0,centerCount=0,cx=Math.floor(maskWidth/2),cy=Math.floor(maskHeight/2),sampleRadius=Math.max(1,Math.floor(.05*Math.min(maskWidth,maskHeight)));for(let y=Math.max(0,cy-sampleRadius);y<=Math.min(maskHeight-1,cy+sampleRadius);y++)for(let x=Math.max(0,cx-sampleRadius);x<=Math.min(maskWidth-1,cx+sampleRadius);x++){let idx=y*maskWidth+x;centerSum+=maskData[idx],centerCount++}let personIsHigh=(centerCount>0?centerSum/centerCount:0)>127,workCanvas=contentCanvasRef.current;workCanvas||(contentCanvasRef.current=workCanvas=document.createElement("canvas")),workCanvas.width=current.width,workCanvas.height=current.height;let ctx=workCanvas.getContext("2d");if(!ctx)throw Error("Failed to get canvas context");ctx.putImageData(current,0,0);let fullBlur=await __TURBOPACK__imported__module__570766__.processor.gaussianBlur(processingControllerRef.current.signal,current,backgroundBlurRadius),composite=ctx.createImageData(current.width,current.height),compData=composite.data,origData=current.data,blurData=fullBlur.data;for(let i=0;i<maskData.length;i++){let pixelIdx=4*i,normalized=maskData[i]/255,personAlpha=personIsHigh?normalized:1-normalized;compData[pixelIdx]=origData[pixelIdx]*personAlpha+blurData[pixelIdx]*(1-personAlpha),compData[pixelIdx+1]=origData[pixelIdx+1]*personAlpha+blurData[pixelIdx+1]*(1-personAlpha),compData[pixelIdx+2]=origData[pixelIdx+2]*personAlpha+blurData[pixelIdx+2]*(1-personAlpha),compData[pixelIdx+3]=origData[pixelIdx+3]}ctx.putImageData(composite,0,0),current=ctx.getImageData(0,0,current.width,current.height)}}if(styleTransferEnabled&&styleImageElement)try{let applyStyleTransfer=async input=>{try{tfRef.current||(tfRef.current=await __turbopack_context__.A(845550));let tf=tfRef.current,styleModuleName="@tensorflow-models/arbitrary-image-stylization";if(!styleModelRef.current)try{let mod=await eval(`import("${styleModuleName}")`);styleModelRef.current=await (mod.load?.()??mod.default?.load?.())}catch(err){return console.warn(`Style transfer module not available: ${styleModuleName}`,err),input}let model=styleModelRef.current,contentCanvas=contentCanvasRef.current;contentCanvas||(contentCanvasRef.current=contentCanvas=document.createElement("canvas")),contentCanvas.width=input.width,contentCanvas.height=input.height;let cctx=contentCanvas.getContext("2d");if(!cctx)return input;cctx.putImageData(input,0,0);let contentImg=new Image;contentImg.src=contentCanvas.toDataURL(),await contentImg.decode();let styleImg=styleImageElement,res=await model.stylize(contentImg,styleImg),outTensor=Array.isArray(res)?res[0]:res,outW=outTensor.shape[1],outH=outTensor.shape[0],outCanvas=outCanvasRef.current;outCanvas||(outCanvasRef.current=outCanvas=document.createElement("canvas")),outCanvas.width=outW,outCanvas.height=outH,await tf.browser.toPixels(outTensor,outCanvas);let outCtx=outCanvas.getContext("2d");if(!outCtx)return input;if(styleStrength>=.999)return outCtx.getImageData(0,0,outW,outH);{let stylized=outCtx.getImageData(0,0,outW,outH),baseCanvas=document.createElement("canvas");baseCanvas.width=outW,baseCanvas.height=outH;let bctx=baseCanvas.getContext("2d");if(!bctx)return stylized;bctx.putImageData(input,0,0);let base=bctx.getImageData(0,0,outW,outH),out=new ImageData(outW,outH);for(let i=0;i<stylized.data.length;i+=4)out.data[i]=stylized.data[i]*styleStrength+base.data[i]*(1-styleStrength),out.data[i+1]=stylized.data[i+1]*styleStrength+base.data[i+1]*(1-styleStrength),out.data[i+2]=stylized.data[i+2]*styleStrength+base.data[i+2]*(1-styleStrength),out.data[i+3]=255;return out}}catch(err){return console.error("Style transfer failed or model not installed:",err),input}};current=await applyStyleTransfer(current)}catch(err){console.error("Style transfer error:",err)}if((faceBlurEnabled||facePixelateEnabled)&&detections.length>0){let workCanvas=contentCanvasRef.current;workCanvas||(contentCanvasRef.current=workCanvas=document.createElement("canvas")),workCanvas.width=current.width,workCanvas.height=current.height;let workCtx=workCanvas.getContext("2d");if(!workCtx)throw Error("Canvas context failed");for(let detection of(workCtx.putImageData(current,0,0),detections)){let processedRegion,bb=detection.boundingBox,x=Math.floor(bb.originX),y=Math.floor(bb.originY),w=Math.ceil(bb.width),h=Math.ceil(bb.height),padX=Math.floor(.2*w),padY=Math.floor(.2*h);x=Math.max(0,x-padX),y=Math.max(0,y-padY),w=Math.min(current.width-x,w+2*padX),h=Math.min(current.height-y,h+2*padY);let region=workCtx.getImageData(x,y,w,h);processedRegion=faceBlurEnabled?await __TURBOPACK__imported__module__570766__.processor.gaussianBlur(processingControllerRef.current.signal,region,faceBlurRadius):await __TURBOPACK__imported__module__570766__.processor.pixelateBlur(processingControllerRef.current.signal,region,faceBlurRadius),workCtx.putImageData(processedRegion,x,y)}current=workCtx.getImageData(0,0,current.width,current.height)}if(effects.flipHorizontal&&(current=await __TURBOPACK__imported__module__570766__.processor.flipHorizontal(processingControllerRef.current.signal,current)),effects.flipVertical&&(current=await __TURBOPACK__imported__module__570766__.processor.flipVertical(processingControllerRef.current.signal,current)),0!==rotation&&(current=await __TURBOPACK__imported__module__570766__.processor.rotate(processingControllerRef.current.signal,current,rotation)),0!==brightness&&(current=await __TURBOPACK__imported__module__570766__.processor.brightness(processingControllerRef.current.signal,current,brightness)),0!==contrast&&(current=await __TURBOPACK__imported__module__570766__.processor.contrast(processingControllerRef.current.signal,current,contrast)),0!==hue&&(current=await __TURBOPACK__imported__module__570766__.processor.hueRotate(processingControllerRef.current.signal,current,hue)),activeFilter&&(current=await __TURBOPACK__imported__module__570766__.processor.filter(processingControllerRef.current.signal,current,activeFilter)),effects.grayscale&&(current=await __TURBOPACK__imported__module__570766__.processor.grayscale(processingControllerRef.current.signal,current)),effects.sepia&&(current=await __TURBOPACK__imported__module__570766__.processor.sepia(processingControllerRef.current.signal,current)),effects.sharpen&&(current=await __TURBOPACK__imported__module__570766__.processor.sharpen(processingControllerRef.current.signal,current)),blurRadius>0&&(current=await __TURBOPACK__imported__module__570766__.processor.gaussianBlur(processingControllerRef.current.signal,current,blurRadius)),activeBlendMode&&overlayData){let blendFuncName=`blend_${activeBlendMode}`;"function"==typeof __TURBOPACK__imported__module__570766__.processor[blendFuncName]&&(current=await __TURBOPACK__imported__module__570766__.processor[blendFuncName](processingControllerRef.current.signal,current,overlayData))}watermark.enabled&&watermark.text.trim()&&(current=await __TURBOPACK__imported__module__570766__.processor.watermark(processingControllerRef.current.signal,current,watermark.text,{fontSize:watermark.size,color:watermark.color,opacity:watermark.opacity,position:watermark.position})),setProcessedData(current)}catch(err){console.error("Processing failed:",err),setProcessedData(current||originalData)}finally{setIsProcessing(!1)}};return applyTimeoutRef.current&&window.clearTimeout(applyTimeoutRef.current),applyTimeoutRef.current=window.setTimeout(()=>{applyAll(),applyTimeoutRef.current=null},200),()=>{applyTimeoutRef.current&&window.clearTimeout(applyTimeoutRef.current);try{processingControllerRef.current?.abort()}catch(e){}}},[originalData,overlayData,rotation,blurRadius,brightness,contrast,hue,activeFilter,activeBlendMode,effects,watermark,faceBlurEnabled,facePixelateEnabled,faceBlurRadius,faceDetectEnabled,backgroundBlurEnabled,backgroundBlurRadius,styleTransferEnabled,styleImageElement,styleStrength]),(0,__TURBOPACK__imported__module__271645__.useEffect)(()=>{let e=()=>setStyleTransferEnabled(e=>!e),t=e=>{let t=e.detail;if(setStyleImageUrl(t),t){let e=new Image;e.onload=()=>setStyleImageElement(e),e.src=t,e.crossOrigin="anonymous"}else setStyleImageElement(null)},a=e=>{setStyleStrength(e.detail)};return window.addEventListener("photoeditor:toggleStyleTransfer",e),window.addEventListener("photoeditor:styleImage",t),window.addEventListener("photoeditor:styleStrength",a),()=>{window.removeEventListener("photoeditor:toggleStyleTransfer",e),window.removeEventListener("photoeditor:styleImage",t),window.removeEventListener("photoeditor:styleStrength",a)}},[]);let handleDownload=()=>{processedData&&canvasRef.current&&canvasRef.current.toBlob(e=>{if(!e)return;let t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;let r=faceBlurEnabled?`gaussian${faceBlurRadius}_`:facePixelateEnabled?`pixelate${faceBlurRadius}_`:backgroundBlurEnabled?`bgblur${backgroundBlurRadius}_`:"",n=faceDetectEnabled?"detect_":"",l=activeFilter?`${activeFilter}_`:"",s=activeBlendMode?`blend_${activeBlendMode}_`:"";a.download=`edited_${r}${n}${s}${l}${rotation}deg_image.png`,a.click(),URL.revokeObjectURL(t)},"image/png")};return(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"min-vh-100 bg-body",children:(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"container py-5",children:[(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"text-center mb-5",children:[(0,__TURBOPACK__imported__module__843476__.jsx)("h1",{className:"display-4 fw-bold text-primary mb-3",children:"ImageProcessor Full Feature Demo"}),(0,__TURBOPACK__imported__module__843476__.jsx)("p",{className:"lead text-body-secondary",children:"Professional editing with AI face detection, blur, pixelate, and portrait background blur"})]}),(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"text-center mb-5",children:[(0,__TURBOPACK__imported__module__843476__.jsx)("input",{ref:fileInputRef,type:"file",accept:"image/*",onChange:handleUpload,className:"d-none"}),(0,__TURBOPACK__imported__module__843476__.jsx)("input",{ref:overlayInputRef,type:"file",accept:"image/*",onChange:handleOverlayUpload,className:"d-none"}),(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"d-flex justify-content-center gap-3 flex-wrap",children:[(0,__TURBOPACK__imported__module__843476__.jsx)("button",{onClick:()=>fileInputRef.current?.click(),className:"btn btn-primary btn-lg px-5 shadow",children:"Upload Base Image"}),(0,__TURBOPACK__imported__module__843476__.jsx)("button",{onClick:()=>overlayInputRef.current?.click(),className:"btn btn-outline-secondary btn-lg px-5 shadow",disabled:!originalData,children:"Upload Overlay Image (for Blend)"})]}),imageUrl&&(0,__TURBOPACK__imported__module__843476__.jsxs)("p",{className:"mt-3 text-muted fs-5",children:["Base: ",originalImage?.width," × ",originalImage?.height," px",overlayData&&" | Overlay loaded"]})]}),originalImage?(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"row g-5",children:[(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"col-lg-4",children:[(0,__TURBOPACK__imported__module__843476__.jsx)(__TURBOPACK__default__export__,{rotation:rotation,setRotation:setRotation,blurRadius:blurRadius,setBlurRadius:setBlurRadius,brightness:brightness,setBrightness:setBrightness,contrast:contrast,setContrast:setContrast,hue:hue,setHue:setHue,activeFilter:activeFilter,setActiveFilter:setActiveFilter,activeBlendMode:activeBlendMode,setActiveBlendMode:setActiveBlendMode,effects:effects,setEffects:setEffects,watermark:watermark,setWatermark:setWatermark,overlayData:overlayData,isProcessing:isProcessing,faceBlurEnabled:faceBlurEnabled,setFaceBlurEnabled:setFaceBlurEnabled,facePixelateEnabled:facePixelateEnabled,setFacePixelateEnabled:setFacePixelateEnabled,faceBlurRadius:faceBlurRadius,setFaceBlurRadius:setFaceBlurRadius,faceDetectEnabled:faceDetectEnabled,setFaceDetectEnabled:setFaceDetectEnabled,backgroundBlurEnabled:backgroundBlurEnabled,setBackgroundBlurEnabled:setBackgroundBlurEnabled,backgroundBlurRadius:backgroundBlurRadius,setBackgroundBlurRadius:setBackgroundBlurRadius,originalImageRef:originalImageRef}),(0,__TURBOPACK__imported__module__843476__.jsx)(ObjectRemovalPanel,{maskCanvasRef:maskCanvasRef,overlayCanvasRef:overlayCanvasRef,originalData:originalData,setOriginalData:setOriginalData,isProcessing:isProcessing,setIsProcessing:setIsProcessing})]}),(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"col-lg-8",children:(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"card shadow border-0",children:[(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"card-header bg-primary text-white text-center",children:(0,__TURBOPACK__imported__module__843476__.jsx)("h5",{className:"mb-0",children:"Live Result"})}),(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"card-body p-4 text-center",children:isProcessing?(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"d-flex flex-column align-items-center justify-content-center",style:{minHeight:"600px"},children:[(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"spinner-border text-primary",style:{width:"5rem",height:"5rem"},role:"status",children:(0,__TURBOPACK__imported__module__843476__.jsx)("span",{className:"visually-hidden",children:"Processing..."})}),(0,__TURBOPACK__imported__module__843476__.jsx)("p",{className:"mt-4 fs-4 text-muted",children:"Applying effects..."})]}):(0,__TURBOPACK__imported__module__843476__.jsxs)(__TURBOPACK__imported__module__843476__.Fragment,{children:[(0,__TURBOPACK__imported__module__843476__.jsx)(PhotoCanvas,{processedData:processedData,canvasRef:canvasRef,overlayCanvasRef:overlayCanvasRef,maskCanvasRef:maskCanvasRef,latestDetections:latestDetections.current,faceDetectEnabled:faceDetectEnabled}),(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"mt-4",children:(0,__TURBOPACK__imported__module__843476__.jsx)("button",{onClick:handleDownload,className:"btn btn-success btn-lg shadow",children:"Download Final Image"})})]})})]})})]}):(0,__TURBOPACK__imported__module__843476__.jsx)("div",{className:"text-center py-5",children:(0,__TURBOPACK__imported__module__843476__.jsxs)("div",{className:"bg-white rounded-4 shadow p-5",children:[(0,__TURBOPACK__imported__module__843476__.jsx)("p",{className:"display-6 text-muted mb-4",children:"No image loaded"}),(0,__TURBOPACK__imported__module__843476__.jsx)("p",{className:"lead",children:"Upload a base image to start editing"})]})})]})})}__turbopack_context__.s(["default",()=>PhotoEditor],754717)},845550,e=>{e.v(t=>Promise.all(["static/chunks/6754254aba73bb55.js","static/chunks/b9e44cf389fad72e.js"].map(t=>e.l(t))).then(()=>t(821324)))}]);